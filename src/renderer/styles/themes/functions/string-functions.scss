// ======================================================
// 字符串处理函数
// ======================================================
@use 'sass:string';
@use 'sass:list';
@use 'sass:math';

// 替换字符串中的子字符串
// @param {String} $string - 原始字符串
// @param {String} $search - 要查找的子字符串
// @param {String} $replace - 替换的字符串
// @return {String} - 替换后的字符串
@function str-replace($string, $search, $replace: '') {
  $index: string.index($string, $search);

  @if $index {
    @return string.slice($string, 1, $index - 1) + $replace + str-replace(string.slice($string, $index + string.length($search)), $search, $replace);
  }

  @return $string;
}

// 将字符串拆分为列表
// @param {String} $string - 要拆分的字符串
// @param {String} $separator - 分隔符
// @return {List} - 拆分后的列表
@function str-split($string, $separator) {
  $result: ();
  $index: string.index($string, $separator);

  @while $index != null {
    $item: string.slice($string, 1, $index - 1);
    $result: list.append($result, $item);
    $string: string.slice($string, $index + string.length($separator));
    $index: string.index($string, $separator);
  }

  @return list.append($result, $string);
}

// 连接字符串列表
// @param {List} $list - 要连接的字符串列表
// @param {String} $separator - 分隔符
// @return {String} - 连接后的字符串
@function str-join($list, $separator: '') {
  $result: '';

  @for $i from 1 through list.length($list) {
    @if $i == 1 {
      $result: list.nth($list, $i);
    } @else {
      $result: $result + $separator + list.nth($list, $i);
    }
  }

  @return $result;
}

// 检查字符串是否以指定子字符串开头
// @param {String} $string - 要检查的字符串
// @param {String} $substring - 开头的子字符串
// @return {Boolean} - 如果是则返回true
@function str-starts-with($string, $substring) {
  @return string.slice($string, 1, string.length($substring)) == $substring;
}

// 检查字符串是否以指定子字符串结尾
// @param {String} $string - 要检查的字符串
// @param {String} $substring - 结尾的子字符串
// @return {Boolean} - 如果是则返回true
@function str-ends-with($string, $substring) {
  $start: string.length($string) - string.length($substring) + 1;

  @return string.slice($string, $start) == $substring;
}

// 去除字符串两端的空白
// @param {String} $string - 要处理的字符串
// @return {String} - 处理后的字符串
@function str-trim($string) {
  $string: str-replace($string, ' ', '');
  $string: str-replace($string, '\t', '');
  $string: str-replace($string, '\n', '');

  @return $string;
}

// 重复字符串N次
// @param {String} $string - 要重复的字符串
// @param {Number} $times - 重复次数
// @return {String} - 重复后的字符串
@function str-repeat($string, $times) {
  $result: '';

  @for $i from 1 through $times {
    $result: $result + $string;
  }

  @return $result;
}

// 将字符串填充到指定长度
// @param {String} $string - 要填充的字符串
// @param {Number} $length - 目标长度
// @param {String} $pad - 填充字符
// @param {String} $side - 填充位置 (left/right/both)
// @return {String} - 填充后的字符串
@function str-pad($string, $length, $pad: ' ', $side: 'right') {
  $string-length: string.length($string);

  @if $string-length >= $length {
    @return $string;
  }

  $pad-length: $length - $string-length;

  @if $side == 'left' {
    @return str-repeat($pad, $pad-length) + $string;
  } @else if $side == 'both' {
    $left-pad: math.floor($pad-length / 2);
    $right-pad: math.ceil($pad-length / 2);

    @return str-repeat($pad, $left-pad) + $string + str-repeat($pad, $right-pad);
  } @else {
    @return $string + str-repeat($pad, $pad-length);
  }
}
