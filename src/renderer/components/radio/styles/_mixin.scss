@use 'sass:map';
@use './variables' as *;

// ==================================================
// #region 基础样式 Mixin
// ==================================================
@mixin radio-base-style {
  .#{$radio-prefix} {
    position: relative;
    box-sizing: border-box;
    display: inline-flex; // Use flex for alignment
    align-items: baseline; // Align based on text baseline
    padding: 0;
    margin: 0;
    font-size: $radio-size-md; // Use default size
    line-height: 1;
    color: $radio-text-color;
    white-space: nowrap; // Prevent label wrapping by default
    cursor: pointer;
    list-style: none;

    // Hide actual radio input, style the custom element
    &__input {
      position: absolute;
      inset: 0;
      z-index: 1;
      margin: 0; // Remove default margin
      cursor: pointer;
      opacity: 0;
    }

    // Custom radio element
    &__inner {
      position: relative;
      display: block;
      flex-shrink: 0; // Prevent inner element from shrinking
      width: $radio-size-md;
      height: $radio-size-md;
      background-color: $radio-bg;
      border: $radio-border-width solid $radio-border-color;
      border-radius: $radio-border-radius;
      transition: $radio-transition;

      // The dot inside
      &::after {
        position: absolute;
        top: 50%;
        left: 50%;
        width: $radio-dot-size-md;
        height: $radio-dot-size-md;
        margin-top: calc($radio-dot-size-md / -2);
        margin-left: calc($radio-dot-size-md / -2);
        content: '';
        background-color: $radio-dot-color;
        border-radius: 50%;
        opacity: 0;
        transform: scale(0);
        transition: transform 0.15s cubic-bezier(0.71, -0.46, 0.88, 0.6), opacity 0.15s;
      }
    }

    // Label text
    &__label {
      flex-grow: 1; // Allow label to take available space
      padding-left: $radio-label-padding-left-md;
      line-height: $radio-size-md; // Match inner size for alignment
      vertical-align: middle; // Keep vertical alignment consistent
    }

    // --- Checked State ---
    &--checked {
      .#{$radio-prefix}__inner {
        background-color: $radio-bg; // Keep bg for contrast
        border-color: $radio-color;

        &::after {
          opacity: 1;
          transform: scale(1);
        }
      }
    }

    // --- Hover State (only when not disabled) ---
    &:hover:not(.#{$radio-prefix}--disabled) {
      .#{$radio-prefix}__inner {
        border-color: $radio-hover-border-color;
      }
    }

    // --- Disabled State ---
    &--disabled {
      cursor: not-allowed;

      .#{$radio-prefix}__input {
        cursor: not-allowed;
      }

      .#{$radio-prefix}__inner {
        background-color: $radio-disabled-bg;
        border-color: $radio-disabled-border-color !important; // Override hover

        &::after {
          background-color: $radio-disabled-dot-color;
        }
      }

      .#{$radio-prefix}__label {
        color: $radio-disabled-text-color;
      }
    }
  }
}
// #endregion
// ==================================================

// ==================================================
// #region 尺寸样式 Mixin
// ==================================================
$radio-sizes: (
  'small': (
    size: $radio-size-sm,
    dot-size: $radio-dot-size-sm,
    padding-left: $radio-label-padding-left-sm
  ),
  'medium': (
    size: $radio-size-md,
    dot-size: $radio-dot-size-md,
    padding-left: $radio-label-padding-left-md
  ),
  'large': (
    size: $radio-size-lg,
    dot-size: $radio-dot-size-lg,
    padding-left: $radio-label-padding-left-lg
  )
);

@mixin radio-size-style {
  @each $size-name, $size-values in $radio-sizes {
    .#{$radio-prefix}--#{$size-name} {
      font-size: map.get($size-values, size); // Apply font size to wrapper for consistency

      .#{$radio-prefix}__inner {
        width: map.get($size-values, size);
        height: map.get($size-values, size);

        &::after {
          width: map.get($size-values, dot-size);
          height: map.get($size-values, dot-size);
          margin-top: calc(map.get($size-values, dot-size) / -2);
          margin-left: calc(map.get($size-values, dot-size) / -2);
        }
      }

      .#{$radio-prefix}__label {
        padding-left: map.get($size-values, padding-left);
        line-height: map.get($size-values, size); // Match inner size
      }
    }
  }
}
// #endregion
// ==================================================

// ==================================================
// #region Radio Button 基础样式 Mixin
// ==================================================
@mixin radio-button-base-style {
  .#{$radio-prefix}-button {
    position: relative;
    display: inline-block;
    height: auto; // Let padding control height
    padding: $radio-button-padding-y-md $radio-button-padding-x-md;
    margin: 0;
    font-size: $radio-size-md; // Match default radio size
    line-height: calc(#{$radio-size-md} + #{$radio-button-padding-y-md} * 2 - #{$radio-border-width} * 2); // Calculate line-height based on padding and border
    color: $radio-button-color;
    text-align: center;
    appearance: none; // Remove default browser appearance
    cursor: pointer;
    outline: 0;
    background: $radio-button-bg;
    border: $radio-border-width solid $radio-button-border-color;
    border-radius: 0; // Buttons in a group typically don't have individual radius
    transition: $radio-transition;

    // Input is still hidden
    &__input {
      position: absolute;
      inset: 0;
      z-index: 1;
      width: 100%;
      height: 100%;
      margin: 0;
      cursor: pointer;
      opacity: 0;
    }

    // --- Group Context Styling ---
    // Add margin between adjacent buttons in a group
    // Use a sibling selector relative to the group
    // Note: This requires the group to manage button spacing or border collapsing
    .#{$radio-group-prefix} &:not(:first-child) {
      margin-left: -#{$radio-border-width}; // Overlap borders
    }

    // --- Hover State (Outline & Solid) ---
    &:hover:not(.#{$radio-prefix}-button--disabled):not(.#{$radio-prefix}-button--checked) {
      position: relative; // Ensure hover stays on top
      z-index: 1;
      color: $radio-button-hover-color;
      border-color: $radio-button-hover-border-color;
    }

    // --- Active State (Outline & Solid) ---
    // Use focus-within on the wrapper to detect input focus
    &:focus-within:not(.#{$radio-prefix}-button--disabled):not(.#{$radio-prefix}-button--checked) {
      z-index: 1;
      color: $radio-button-active-color;
      // Simulating AntD's focus ring - can be customized
      // box-shadow: 0 0 0 2px rgba($radio-color, 0.2);
      border-color: $radio-button-active-border-color;
    }

    // --- Disabled State (Outline & Solid) ---
    &--disabled {
      color: $radio-button-disabled-color;
      cursor: not-allowed;
      background-color: $radio-button-disabled-bg;
      border-color: $radio-button-disabled-border-color;

      &.#{$radio-prefix}-button--checked {
        color: $radio-button-checked-disabled-color;
        background-color: $radio-button-checked-disabled-bg;
        border-color: $radio-button-checked-disabled-border-color;
      }
    }
  }
}
// #endregion
// ==================================================

// ==================================================
// #region Radio Button 尺寸 Mixin
// ==================================================
$radio-button-sizes: (
  'small': (
    font-size: $radio-size-sm,
    padding-y: $radio-button-padding-y-sm,
    padding-x: $radio-button-padding-x-sm
  ),
  'medium': (
    font-size: $radio-size-md,
    padding-y: $radio-button-padding-y-md,
    padding-x: $radio-button-padding-x-md
  ),
  'large': (
    font-size: $radio-size-lg,
    padding-y: $radio-button-padding-y-lg,
    padding-x: $radio-button-padding-x-lg
  )
);

@mixin radio-button-size-style {
  @each $size-name, $size-values in $radio-button-sizes {
    .#{$radio-prefix}-button--#{$size-name} {
      padding: map.get($size-values, padding-y) map.get($size-values, padding-x);
      font-size: map.get($size-values, font-size);
      line-height: calc(#{map.get($size-values, font-size)} + #{map.get($size-values, padding-y)} * 2 - #{$radio-border-width} * 2);
    }
  }
}
// #endregion
// ==================================================

// ==================================================
// #region Radio Button 样式 (Outline/Solid Checked) Mixin
// ==================================================
@mixin radio-button-variant-style {
  // --- Outline Checked State ---
  .#{$radio-prefix}-button--checked:not(.#{$radio-prefix}-button--style-solid) {
    position: relative;
    z-index: 1;
    color: $radio-button-checked-color;
    background: $radio-button-checked-bg;
    border-color: $radio-button-checked-border-color;

    &:hover:not(.#{$radio-prefix}-button--disabled) {
      color: $radio-button-checked-hover-color;
      background: $radio-button-checked-hover-bg;
      border-color: $radio-button-checked-hover-border-color;
    }
  }

  // --- Solid Checked State ---
  .#{$radio-prefix}-button--checked.#{$radio-prefix}-button--style-solid {
    position: relative;
    z-index: 1;
    color: $radio-button-solid-checked-color;
    background: $radio-button-solid-checked-bg;
    border-color: $radio-button-solid-checked-border-color;

    &:hover:not(.#{$radio-prefix}-button--disabled) {
      color: $radio-button-solid-checked-color; // Hover color usually same for solid
      background: $radio-button-solid-checked-hover-bg;
      border-color: $radio-button-solid-checked-hover-border-color;
    }

    // Active state for solid checked
    &:active:not(.#{$radio-prefix}-button--disabled) {
      background: $radio-button-solid-checked-active-bg;
      border-color: $radio-button-solid-checked-active-border-color;
    }

    // Disabled state for solid checked (already covered partially, but ensure specific bg/color)
    &.#{$radio-prefix}-button--disabled {
      color: $radio-button-checked-disabled-color;
      background-color: $radio-button-checked-disabled-bg;
      border-color: $radio-button-checked-disabled-border-color;
    }
  }
}
// #endregion
// ==================================================

// ==================================================
// #region Radio Group Mixin
// ==================================================
@mixin radio-group-style {
  .#{$radio-group-prefix} {
    display: inline-block; // Default display
    font-size: 0; // Collapse space between inline-block radio/buttons
    line-height: unset; // Reset line-height

    // --- Button Group Specific ---
    &.#{$radio-group-prefix}--button {
      display: inline-flex; // Use flex for button group alignment
      flex-wrap: wrap; // Allow wrapping
      gap: 0; // 确保flex子项之间没有间隙

      // 修复相邻按钮间距问题
      .#{$radio-prefix}-button {
        margin-right: 0; // 确保没有右侧外边距
        margin-bottom: 0; // 确保没有底部外边距
      }

      // Handle border radius for first/last items
      .#{$radio-prefix}-button:first-child {
        border-top-left-radius: $radio-button-border-radius;
        border-bottom-left-radius: $radio-button-border-radius;
      }
      .#{$radio-prefix}-button:last-child {
        border-top-right-radius: $radio-button-border-radius;
        border-bottom-right-radius: $radio-button-border-radius;
      }

      // Handle border collapsing more robustly
      .#{$radio-prefix}-button:not(:first-child) {
        margin-left: -#{$radio-border-width}; // 负边距确保边框重叠
      }

      // Ensure checked button overlaps adjacent siblings correctly
      .#{$radio-prefix}-button--checked {
        z-index: 1;
      }
      .#{$radio-prefix}-button:hover,
      .#{$radio-prefix}-button:focus-within {
        position: relative;
        z-index: 1; // Ensure hover/focus brings button to front
      }
    }

    // --- Vertical Layout ---
    &.#{$radio-group-prefix}--vertical {
      display: flex;
      flex-direction: column;

      .#{$radio-prefix}:not(:last-child) {
        margin-bottom: 8px; // Add spacing between vertical radios
      }
      // Remove button specific styles if vertical
      &.#{$radio-group-prefix}--button {
        .#{$radio-prefix}-button:not(:first-child) {
          margin-top: -#{$radio-border-width}; // Overlap vertically
          margin-left: 0;
        }
        .#{$radio-prefix}-button:first-child,
        .#{$radio-prefix}-button:last-child {
          border-radius: $radio-button-border-radius;
        }
        .#{$radio-prefix}-button:not(:first-child):not(:last-child) {
          border-radius: 0;
        }
        // Specific radius for vertical ends
        .#{$radio-prefix}-button:first-child {
          border-bottom-right-radius: 0;
          border-bottom-left-radius: 0;
        }
        .#{$radio-prefix}-button:last-child {
          border-top-left-radius: 0;
          border-top-right-radius: 0;
        }
      }
    }

    // --- Block Layout (for Button Group) ---
    &.#{$radio-group-prefix}--block {
      display: flex;
      .#{$radio-prefix}-button {
        flex: 1;
      }
    }
  }
}
// #endregion
// ==================================================
